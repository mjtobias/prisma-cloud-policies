{
  "policyUpi": "PC-AZR-NWK-54",
  "policyId": "a36a7170-d628-47fe-aab2-0e734702373d",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "high",
  "name": "Azure Network Security Group allows all traffic on RDP Port 3389",
  "description": "This policy identifies any NSG rule that allow all traffic on RDP port 3389. Review your list of NSG rules to ensure that your resources are not exposed. As a best practice, restrict RDP solely to known static IP addresses. Limit the access list to include known hosts, services, or specific employees only.",
  "rule.criteria": "a36a7170-d628-47fe-aab2-0e734702373d",
  "searchModel.query": "config from cloud.resource where cloud.type = 'azure' AND api.name= 'azure-network-nsg-list' AND json.rule = securityRules[?any(access equals Allow and direction equals Inbound and (sourceAddressPrefix equals Internet or sourceAddressPrefix equals * or sourceAddressPrefix equals 0.0.0.0/0 or sourceAddressPrefix equals ::/0) and (destinationPortRange contains _Port.inRange(3389,3389) or destinationPortRanges[*] contains _Port.inRange(3389,3389) ))] exists",
  "recommendation": "Before making any changes, please check the impact to your applications/services. Evaluate whether you want to edit the rule and limit access to specific users, hosts, and services only, deny access, or delete the rule completely.\n\n1. Log in to the Azure Portal.\n2. Select 'All services'.\n3. Select 'Network security groups', under NETWORKING.\n4. Select the Network security group you need to modify.\n5. Select 'Inbound security rules' under Settings.\n6. Select the rule you need to modify, and edit it to allow specific IP addresses OR set the 'Action' to 'Deny' OR 'Delete' the rule based on your requirement.\n7. 'Save' your changes.",
  "remediable": true,
  "remediation.cliScriptTemplate": "az network nsg rule update --name ${ruleName} --resource-group ${resourceGroup} --nsg-name ${resourceName} --access Deny",
  "remediation.description": "This CLI command requires 'Microsoft.Network/networkSecurityGroups/securityRules/*' permission. Successful execution will update the network security group to revoke the inbound rule records allowing traffic from Internet on port 3389.",
  "remediation.impact": "reject all traffic from Internet on port 3389",
  "compliance.standard": [
    "CCPA 2018",
    "CIS v1.1 (Azure)",
    "CSA CCM v3.0.1",
    "GDPR",
    "HIPAA",
    "HITRUST CSF v9.3",
    "MITRE ATT&CK [Beta]",
    "Multi-Level Protection Scheme (MLPS) v2.0",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "PCI DSS v3.2",
    "PIPEDA",
    "SOC 2"
  ]
}