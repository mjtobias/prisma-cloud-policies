{
  "policyUpi": "PC-AZR-SQL-106",
  "policyId": "96b1b8e3-6936-434f-94ab-a154cd5967d9",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "medium",
  "name": "Azure SQL database auditing is disabled",
  "description": "This policy identifies SQL databases in which auditing is set to Off.  Database events are tracked by the Auditing feature and the events are written to an audit log in your Audit log destinations. This process helps you to monitor database activity, and get insight into anomalies that could indicate business concerns or suspected security violations.",
  "rule.criteria": "8e7342aa-be1e-4db1-8775-c886a16d085a",
  "searchModel.query": "config from cloud.resource where api.name = 'azure-sql-db-list' as X; config from cloud.resource where api.name = 'azure-sql-server-list' as Y; filter \"($.X.blobAuditPolicy.properties.state equals Disabled or $.X.blobAuditPolicy does not exist or $.X.blobAuditPolicy.[*] is empty) and ($.X.blobAuditPolicy.id contains $.Y.sqlServer.name and $.Y.serverBlobAuditingPolicy.properties.state equals Disabled or $.Y.serverBlobAuditingPolicy does not exist or $.Y.serverBlobAuditingPolicy is empty)\"; show X;",
  "recommendation": "If server auditing is enabled, it always applies to the database. The database will be audited, regardless of the database auditing settings. It is recommended that you enable only server-level auditing and leave the database-level auditing disabled for all databases.\n\nTo enable auditing at server level:\n1. Log in to the Azure Portal\n2. Note down the reported SQL database and SQL server\n3. Select 'SQL servers', Click on the SQL server instance you wanted to modify\n4. Select 'Auditing' under 'Security' section, and set the status to 'On' and choose any Audit log destinations.\n5.  Click on 'Save'\n\nIt is recommended to avoid enabling both server auditing and database blob auditing together, unless:\nIf you want to use a different storage account, retention period or Log Analytics Workspace for a specific database or want to use for audit event types or categories for a specific database that differ from the rest of the databases on the server.\nTo enable auditing at database level:\n1. Log in to the Azure Portal\n2. Note down the reported SQL database\n3. Select 'SQL databases', Click on the SQL database instance you wanted to modify\n4. Select 'Auditing' under 'Security' section, and set the status to 'On' and choose any Audit log destinations.\n5.  Click on 'Save'",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "CCPA 2018",
    "CSA CCM v3.0.1",
    "GDPR",
    "HIPAA",
    "HITRUST CSF v9.3",
    "ISO 27001:2013",
    "Multi-Level Protection Scheme (MLPS) v2.0",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "PCI DSS v3.2",
    "PIPEDA",
    "SOC 2"
  ]
}