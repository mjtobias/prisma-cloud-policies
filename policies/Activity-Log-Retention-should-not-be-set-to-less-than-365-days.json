{
  "policyUpi": "PC-AZR-MON-100",
  "policyId": "a9937384-1ee3-430c-acda-fb97e357bfcd",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "medium",
  "name": "Activity Log Retention should not be set to less than 365 days",
  "description": "A Log Profile controls how your Activity Log is exported and retained. Since the average time to detect a breach is over 200 days, it is recommended to retain your activity log for 365 days or more in order to have time to respond to any incidents.",
  "rule.criteria": "700e9da9-b460-41f7-a4c6-b38cc9fcf588",
  "searchModel.query": "config from cloud.resource where cloud.type = 'azure' AND cloud.service = 'Azure Monitor' AND api.name = 'azure-monitor-log-profiles-list' AND json.rule = 'isLegacy is true and (properties.retentionPolicy !exists or (properties.retentionPolicy.days != 0 and properties.retentionPolicy.days < 365))'",
  "recommendation": "If there is no activity log profile exists follow below steps:\n1. Log in to Azure Portal\n2. Navigate to Monitor dashboard\n3. Click on Activity log\n4. Click on 'Diagnostics Settings'\n5. Click on \"Looking for the legacy experience? Click here to launch the 'Export activity log' blade\"\n6. Set 'Retention (days)' to '365' and other parameters to as per you requirement\n7. Click on 'Save'\nIf a log profile already exists we cannot update the retention days through console. Follow below CLI command to update the log profile:\n\"az monitor log-profiles update --name ${resourceName} --set retentionPolicy.days=365 retentionPolicy.enabled=true location=global\"",
  "remediable": true,
  "remediation.cliScriptTemplate": "az monitor log-profiles update --name ${resourceName} --set retentionPolicy.days=365 retentionPolicy.enabled=true location=global",
  "remediation.description": "This CLI command requires 'Microsoft.Insights/LogProfiles/[Read, Write, Delete]' permission. Successful execution will update the Azure monitor log profile retention policy days to 365 days.",
  "remediation.impact": "update the Azure monitor log profile retention policy days to 365 days",
  "compliance.standard": [
    "CCPA 2018",
    "CIS v1.1 (Azure)",
    "CSA CCM v3.0.1",
    "HIPAA",
    "HITRUST CSF v9.3",
    "ISO 27001:2013",
    "Multi-Level Protection Scheme (MLPS) v2.0",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "PCI DSS v3.2",
    "PIPEDA",
    "SOC 2"
  ]
}