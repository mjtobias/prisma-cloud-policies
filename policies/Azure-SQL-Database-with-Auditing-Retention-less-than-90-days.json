{
  "policyUpi": "PC-AZR-SQL-105",
  "policyId": "fa6fa903-8887-49dd-917f-91687df98dd1",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "medium",
  "name": "Azure SQL Database with Auditing Retention less than 90 days",
  "description": "This policy identifies SQL Databases that have Auditing Retention less than 90 days. Audit Logs can be used to check for anomalies and gives insight into suspected breaches or misuse of information and access. If server auditing is enabled, it always applies to the database. The database will be audited, regardless of the database auditing settings. It is recommended to configure SQL database Audit Retention to be greater than or equal to 90 days and leave the database-level auditing disabled for all databases.",
  "rule.criteria": "7422d8e8-4b0a-4bc5-9769-462b3cd1c6f6",
  "searchModel.query": "config from cloud.resource where api.name = 'azure-sql-server-list' AND json.rule = '(serverBlobAuditingPolicy does not exist or serverBlobAuditingPolicy is empty or serverBlobAuditingPolicy.properties.state equals Disabled or serverBlobAuditingPolicy.properties.retentionDays does not exist or (serverBlobAuditingPolicy.properties.state equals Enabled and serverBlobAuditingPolicy.properties.retentionDays does not equal 0 and serverBlobAuditingPolicy.properties.retentionDays less than 90))' as X; config from cloud.resource where api.name = 'azure-sql-db-list' AND json.rule = 'blobAuditPolicy does not exist or blobAuditPolicy is empty or blobAuditPolicy.properties.retentionDays does not exist or (blobAuditPolicy.properties.state equals Enabled and blobAuditPolicy.properties.retentionDays does not equal 0 and blobAuditPolicy.properties.retentionDays less than 90)' as Y; filter '$.X.blobAuditPolicy.id contains $.Y.sqlServer.name'; show Y;",
  "recommendation": "If server auditing is enabled, it always applies to the database. The database will be audited, regardless of the database auditing settings. It is recommended that you enable only server-level auditing setting and leave the database-level auditing disabled for all databases.\n\nTo configure the Server level audit setting:\n1. Log in to the Azure Portal\n2. Go to SQL servers\n3. Choose the reported each DB server\n4. Under the Security section, Click on 'Auditing'\n5. Set 'Auditing' to 'On'\n6. Select 'Storage' and click on 'Storage Details'\n7. Configure 'Retention (days)' setting to greater than or equal to 90 days\nNote: The default value for the retention period is 0 (unlimited retention).\n8. Click on 'Ok'\n9. Click on 'Save'\n\nIt is recommended to avoid enabling both server auditing and database blob auditing together, unless; If you want to use a different storage account, retention period or Log Analytics Workspace for a specific database or want to use for audit event types or categories for a specific database that differ from the rest of the databases on the server.\nTo configure the Database level audit setting:\n1. Log in to the Azure Portal\n2. Go to SQL databases\n3. Choose the reported each DB\n4. Under the Security section, Click on 'Auditing'\n5. Set 'Auditing' to 'On'\n6. Select 'Storage' and click on 'Storage Details'\n7. Configure 'Retention (days)' setting to greater than or equal to 90 days\nNote: The default value for the retention period is 0 (unlimited retention).\n8. Click on 'Ok'\n9. Click on 'Save'",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "CCPA 2018",
    "CSA CCM v3.0.1",
    "HIPAA",
    "HITRUST CSF v9.3",
    "ISO 27001:2013",
    "Multi-Level Protection Scheme (MLPS) v2.0",
    "NIST 800-53 Rev4",
    "NIST CSF",
    "PCI DSS v3.2",
    "PIPEDA",
    "SOC 2"
  ]
}